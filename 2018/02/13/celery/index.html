<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#4e72b8"><meta name="author" content="Â§© Âê¨"><meta name="copyright" content="Â§© Âê¨"><meta name="generator" content="Hexo 5.3.0"><meta name="theme" content="hexo-theme-yun"><title>Celery | Â§©Âê¨„ÅÆblog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.22/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#4e72b8"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"godhearing.cn","root":"/","title":["Â§©","Âê¨","„ÅÆ","blog"],"version":"1.4.0","mode":"auto","copycode":true,"page":{"isPost":true},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"/data/sentences.json"},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="Â§©Âê¨„ÅÆblog" type="application/atom+xml"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><meta name="description" content="‰ªãÁªçÔºö1.1 celeryÂ∫îÁî®‰∏æ‰æã Celery ÊòØ‰∏Ä‰∏™ Âü∫‰∫épythonÂºÄÂèëÁöÑÂàÜÂ∏ÉÂºèÂºÇÊ≠•Ê∂àÊÅØ‰ªªÂä°ÈòüÂàóÔºåÈÄöËøáÂÆÉÂèØ‰ª•ËΩªÊùæÁöÑÂÆûÁé∞‰ªªÂä°ÁöÑÂºÇÊ≠•Â§ÑÁêÜÔºåÂ¶ÇÊûú‰Ω†ÁöÑ‰∏öÂä°Âú∫ÊôØ‰∏≠ÈúÄË¶ÅÁî®Âà∞ÂºÇÊ≠•‰ªªÂä°ÔºåÂ∞±ÂèØ‰ª•ËÄÉËôë‰ΩøÁî®celery  ‰Ω†ÊÉ≥ÂØπ100Âè∞Êú∫Âô®ÊâßË°å‰∏ÄÊù°ÊâπÈáèÂëΩ‰ª§ÔºåÂèØËÉΩ‰ºöËä±ÂæàÈïøÊó∂Èó¥ Ôºå‰ΩÜ‰Ω†‰∏çÊÉ≥ËÆ©‰Ω†ÁöÑÁ®ãÂ∫èÁ≠âÁùÄÁªìÊûúËøîÂõûÔºåËÄåÊòØÁªô‰Ω†ËøîÂõû ‰∏Ä‰∏™‰ªªÂä°ID,‰Ω†Ëøá‰∏ÄÊÆµÊó∂Èó¥Âè™ÈúÄË¶ÅÊãøÁùÄËøô‰∏™‰ªªÂä°idÂ∞±ÂèØ‰ª•ÊãøÂà∞‰ªªÂä°ÊâßË°åÁªìÊûúÔºå Âú®‰ªªÂä°ÊâßË°åingËøõ">
<meta property="og:type" content="article">
<meta property="og:title" content="Celery">
<meta property="og:url" content="http://godhearing.cn/2018/02/13/celery/index.html">
<meta property="og:site_name" content="Â§©Âê¨„ÅÆblog">
<meta property="og:description" content="‰ªãÁªçÔºö1.1 celeryÂ∫îÁî®‰∏æ‰æã Celery ÊòØ‰∏Ä‰∏™ Âü∫‰∫épythonÂºÄÂèëÁöÑÂàÜÂ∏ÉÂºèÂºÇÊ≠•Ê∂àÊÅØ‰ªªÂä°ÈòüÂàóÔºåÈÄöËøáÂÆÉÂèØ‰ª•ËΩªÊùæÁöÑÂÆûÁé∞‰ªªÂä°ÁöÑÂºÇÊ≠•Â§ÑÁêÜÔºåÂ¶ÇÊûú‰Ω†ÁöÑ‰∏öÂä°Âú∫ÊôØ‰∏≠ÈúÄË¶ÅÁî®Âà∞ÂºÇÊ≠•‰ªªÂä°ÔºåÂ∞±ÂèØ‰ª•ËÄÉËôë‰ΩøÁî®celery  ‰Ω†ÊÉ≥ÂØπ100Âè∞Êú∫Âô®ÊâßË°å‰∏ÄÊù°ÊâπÈáèÂëΩ‰ª§ÔºåÂèØËÉΩ‰ºöËä±ÂæàÈïøÊó∂Èó¥ Ôºå‰ΩÜ‰Ω†‰∏çÊÉ≥ËÆ©‰Ω†ÁöÑÁ®ãÂ∫èÁ≠âÁùÄÁªìÊûúËøîÂõûÔºåËÄåÊòØÁªô‰Ω†ËøîÂõû ‰∏Ä‰∏™‰ªªÂä°ID,‰Ω†Ëøá‰∏ÄÊÆµÊó∂Èó¥Âè™ÈúÄË¶ÅÊãøÁùÄËøô‰∏™‰ªªÂä°idÂ∞±ÂèØ‰ª•ÊãøÂà∞‰ªªÂä°ÊâßË°åÁªìÊûúÔºå Âú®‰ªªÂä°ÊâßË°åingËøõ">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://godhearing.cn/2018/02/13/celery/602127040446.png">
<meta property="article:published_time" content="2018-02-13T14:25:00.000Z">
<meta property="article:modified_time" content="2018-02-13T14:25:00.000Z">
<meta property="article:author" content="Â§© Âê¨">
<meta property="article:tag" content="python">
<meta property="article:tag" content="Django">
<meta property="article:tag" content="Celery">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://godhearing.cn/2018/02/13/celery/602127040446.png"><script src="/js/ui/mode.js"></script>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><canvas id="trianglifyContainer"></canvas><script defer src="https://cdn.jsdelivr.net/npm/trianglify@4/dist/trianglify.bundle.js"></script><script>document.addEventListener("DOMContentLoaded", () => {
  const pattern = trianglify({
    width: 800,
    height: 600,
    cellSize: 65,
    palette: ["YlGnBu", "GnBu", "Purples", "Blues","Reds","Oranges"],
  });
  const canvasOpts = {
    applyCssScaling: false
  }
  document.body.appendChild(pattern.toCanvas(trianglifyContainer, canvasOpts));
});</script><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="Â§© Âê¨"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Â§© Âê¨"><span class="site-author-status" title="ÊòéÂ§©ÔºåÂè™ÊòØ‰∏Ä‰∏™Â∏åÊúõÔºå‰∏çÊòØ‰∏Ä‰∏™ÊâøËØ∫">üòä</span></a><div class="site-author-name"><a href="/about/">Â§© Âê¨</a></div><a class="site-name" href="/about/site.html">Â§©Âê¨„ÅÆblog</a><sub class="site-subtitle">Â§©Âê¨</sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">72</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">22</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">32</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://www.baidu.com/" title="ÈÄöÂêë‰∏Ä‰∏™‰∏á‰∫ãÈÉΩËÉΩËß£ÂÜ≥ÁöÑÂú∞Êñπ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=epvxdq1sknJe9JMj6J1LsBw4a6cI_2ln&amp;jump_from=webapi" title="QQÈÇÆ‰ª∂Âú∞ÂùÄ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/God-hearing2020" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="ÁΩëÊòì‰∫ëÈü≥‰πê" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/godhearing1" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://haoye0822@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="ÊàëÁöÑÂ∞è‰ºô‰º¥‰ª¨" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="ÊàëÊúÄÂñúÊ¨¢ÁöÑÊòéÊòü" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">‰ªãÁªçÔºö</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-celery%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 celeryÂ∫îÁî®‰∏æ‰æã</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Celery%E6%9C%89%E4%BB%A5%E4%B8%8B%E4%BC%98%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 CeleryÊúâ‰ª•‰∏ã‰ºòÁÇπ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Celery-%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Celery ÁâπÊÄß</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Celery%E7%BB%84%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">CeleryÁªÑ‰ª∂</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Celery-%E6%89%AE%E6%BC%94%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E8%A7%92%E8%89%B2"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Celery ÊâÆÊºîÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑËßíËâ≤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-celery%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 celeryÊû∂ÊûÑÂõæ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E4%BA%A7%E7%94%9F%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 ‰∫ßÁîü‰ªªÂä°ÁöÑÊñπÂºè</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-celery-%E4%BE%9D%E8%B5%96%E4%B8%89%E4%B8%AA%E5%BA%93-%E8%BF%99%E4%B8%89%E4%B8%AA%E5%BA%93-%E9%83%BD%E7%94%B1-Celery-%E7%9A%84%E5%BC%80%E5%8F%91%E8%80%85%E5%BC%80%E5%8F%91%E5%92%8C%E7%BB%B4%E6%8A%A4"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 celery ‰æùËµñ‰∏â‰∏™Â∫ì: Ëøô‰∏â‰∏™Â∫ì, ÈÉΩÁî± Celery ÁöÑÂºÄÂèëËÄÖÂºÄÂèëÂíåÁª¥Êä§.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AECelery"><span class="toc-number">3.</span> <span class="toc-text">ÈÖçÁΩÆCelery</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85celery"><span class="toc-number">3.1.</span> <span class="toc-text">ÂÆâË£Öcelery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAcelery-main-py%E9%85%8D%E7%BD%AEcelery"><span class="toc-number">3.2.</span> <span class="toc-text">Êñ∞Âª∫celery&#x2F;main.pyÈÖçÁΩÆcelery</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.</span> <span class="toc-text">ÊµãËØï</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8celery"><span class="toc-number">4.1.</span> <span class="toc-text">ÂêØÂä®celery</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8celery%E5%BC%82%E6%AD%A5%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1"><span class="toc-number">5.</span> <span class="toc-text">1.‰ΩøÁî®celeryÂºÇÊ≠•ÂèëÈÄÅÁü≠‰ø°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9C%A8celery-task-mian-py%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">1.1 Âú®celery_task&#x2F;mian.py‰∏≠Ê∑ªÂä†ÂèëÈÄÅÁü≠‰ø°ÂáΩÊï∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%9C%A8verifications-views-py%E4%B8%AD%E6%B7%BB%E5%8A%A0celery%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.</span> <span class="toc-text">1.2 Âú®verifications&#x2F;views.py‰∏≠Ê∑ªÂä†celeryÂèëÈÄÅÁü≠‰ø°ËßÜÂõæÂáΩÊï∞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1"><span class="toc-number">5.3.</span> <span class="toc-text">1.3 Ê∑ªÂä†Ë∑ØÁî±</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.</span> <span class="toc-text">2.ÊµãËØïÊé•Âè£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#django%E6%B7%BB%E5%8A%A0%E6%A3%80%E6%9F%A5%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E6%89%8B%E6%9C%BA%E5%8F%B7%E6%95%B0%E9%87%8F%E6%8E%A5%E5%8F%A3"><span class="toc-number">7.</span> <span class="toc-text">djangoÊ∑ªÂä†Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÊâãÊú∫Âè∑Êï∞ÈáèÊé•Âè£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9C%A8user-urls-py%E4%B8%AD%E6%B7%BB%E5%8A%A0"><span class="toc-number">7.1.</span> <span class="toc-text">1.1 Âú®user&#x2F;urls.py‰∏≠Ê∑ªÂä†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%9C%A8user-views-py%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">1.2 Âú®user&#x2F;views.py‰∏≠Ê∑ªÂä†ËßÜÂõæÂáΩÊï∞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3"><span class="toc-number">8.</span> <span class="toc-text">ÊµãËØïÊé•Âè£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E6%B3%A8%E5%86%8C%E6%8E%A5%E5%8F%A3"><span class="toc-number">9.</span> <span class="toc-text">ÂÆåÂñÑÊ≥®ÂÜåÊé•Âè£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9user-views-py%E4%B8%AD%E5%AE%8C%E5%96%84%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">9.1.</span> <span class="toc-text">‰øÆÊîπuser&#x2F;views.py‰∏≠ÂÆåÂñÑËßÜÂõæÂáΩÊï∞</span></a></li></ol></li></ol></div></div></div><div class="tag-cloud"><div class="tag-cloud-tags"><a href="/tags/Book/" style="font-size: 12px; color: #ffc20e">Book</a> <a href="/tags/Celery/" style="font-size: 12px; color: #ffc20e">Celery</a> <a href="/tags/Django/" style="font-size: 30px; color: #00a6ac">Django</a> <a href="/tags/Docker/" style="font-size: 24px; color: #55af77">Docker</a> <a href="/tags/FastAPI/" style="font-size: 18px; color: #aab943">FastAPI</a></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://godhearing.cn/2018/02/13/celery/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Â§© Âê¨"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Â§©Âê¨„ÅÆblog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Celery</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2018-02-13 22:25:00" itemprop="dateCreated datePublished" datetime="2018-02-13T22:25:00+08:00">2018-02-13</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/Celery/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Celery</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/python/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">python</span></a><a class="tag" href="/tags/Django/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Django</span></a><a class="tag" href="/tags/Celery/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Celery</span></a></span></div><div class="post-author"><span class="author-name">Â§©Âê¨</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#4e72b8;"><h2 id="‰ªãÁªçÔºö"><a href="#‰ªãÁªçÔºö" class="headerlink" title="‰ªãÁªçÔºö"></a>‰ªãÁªçÔºö</h2><h3 id="1-1-celeryÂ∫îÁî®‰∏æ‰æã"><a href="#1-1-celeryÂ∫îÁî®‰∏æ‰æã" class="headerlink" title="1.1 celeryÂ∫îÁî®‰∏æ‰æã"></a>1.1 celeryÂ∫îÁî®‰∏æ‰æã</h3><ul>
<li><p>Celery ÊòØ‰∏Ä‰∏™ Âü∫‰∫épythonÂºÄÂèëÁöÑÂàÜÂ∏ÉÂºèÂºÇÊ≠•Ê∂àÊÅØ‰ªªÂä°ÈòüÂàóÔºåÈÄöËøáÂÆÉÂèØ‰ª•ËΩªÊùæÁöÑÂÆûÁé∞‰ªªÂä°ÁöÑÂºÇÊ≠•Â§ÑÁêÜÔºåÂ¶ÇÊûú‰Ω†ÁöÑ‰∏öÂä°Âú∫ÊôØ‰∏≠ÈúÄË¶ÅÁî®Âà∞ÂºÇÊ≠•‰ªªÂä°ÔºåÂ∞±ÂèØ‰ª•ËÄÉËôë‰ΩøÁî®celery</p>
</li>
<li><p>‰Ω†ÊÉ≥ÂØπ100Âè∞Êú∫Âô®ÊâßË°å‰∏ÄÊù°ÊâπÈáèÂëΩ‰ª§ÔºåÂèØËÉΩ‰ºöËä±ÂæàÈïøÊó∂Èó¥ Ôºå‰ΩÜ‰Ω†‰∏çÊÉ≥ËÆ©‰Ω†ÁöÑÁ®ãÂ∫èÁ≠âÁùÄÁªìÊûúËøîÂõûÔºåËÄåÊòØÁªô‰Ω†ËøîÂõû ‰∏Ä‰∏™‰ªªÂä°ID,‰Ω†Ëøá‰∏ÄÊÆµÊó∂Èó¥Âè™ÈúÄË¶ÅÊãøÁùÄËøô‰∏™‰ªªÂä°idÂ∞±ÂèØ‰ª•ÊãøÂà∞‰ªªÂä°ÊâßË°åÁªìÊûúÔºå Âú®‰ªªÂä°ÊâßË°åingËøõË°åÊó∂Ôºå‰Ω†ÂèØ‰ª•ÁªßÁª≠ÂÅöÂÖ∂ÂÆÉÁöÑ‰∫ãÊÉÖ</p>
</li>
<li><p>Celery Âú®ÊâßË°å‰ªªÂä°Êó∂ÈúÄË¶ÅÈÄöËøá‰∏Ä‰∏™Ê∂àÊÅØ‰∏≠Èó¥‰ª∂Êù•Êé•Êî∂ÂíåÂèëÈÄÅ‰ªªÂä°Ê∂àÊÅØÔºå‰ª•ÂèäÂ≠òÂÇ®‰ªªÂä°ÁªìÊûúÔºå ‰∏ÄËà¨‰ΩøÁî®rabbitMQ or Redis</p>
</li>
</ul>
<h3 id="1-2-CeleryÊúâ‰ª•‰∏ã‰ºòÁÇπ"><a href="#1-2-CeleryÊúâ‰ª•‰∏ã‰ºòÁÇπ" class="headerlink" title="1.2 CeleryÊúâ‰ª•‰∏ã‰ºòÁÇπ"></a>1.2 CeleryÊúâ‰ª•‰∏ã‰ºòÁÇπ</h3><ul>
<li>ÁÆÄÂçïÔºö‰∏ÄÂçïÁÜüÊÇâ‰∫ÜceleryÁöÑÂ∑•‰ΩúÊµÅÁ®ãÂêéÔºåÈÖçÁΩÆÂíå‰ΩøÁî®ËøòÊòØÊØîËæÉÁÆÄÂçïÁöÑ</li>
<li>È´òÂèØÁî®ÔºöÂΩì‰ªªÂä°ÊâßË°åÂ§±Ë¥•ÊàñÊâßË°åËøáÁ®ã‰∏≠ÂèëÁîüËøûÊé•‰∏≠Êñ≠Ôºåcelery ‰ºöËá™Âä®Â∞ùËØïÈáçÊñ∞ÊâßË°å‰ªªÂä°</li>
<li>Âø´ÈÄüÔºö‰∏Ä‰∏™ÂçïËøõÁ®ãÁöÑceleryÊØèÂàÜÈíüÂèØÂ§ÑÁêÜ‰∏äÁôæ‰∏á‰∏™‰ªªÂä°</li>
<li>ÁÅµÊ¥ªÔºö Âá†‰πéceleryÁöÑÂêÑ‰∏™ÁªÑ‰ª∂ÈÉΩÂèØ‰ª•Ë¢´Êâ©Â±ïÂèäËá™ÂÆöÂà∂</li>
</ul>
<h3 id="1-3-Celery-ÁâπÊÄß"><a href="#1-3-Celery-ÁâπÊÄß" class="headerlink" title="1.3 Celery ÁâπÊÄß"></a>1.3 Celery ÁâπÊÄß</h3><ul>
<li>Êñπ‰æøÊü•ÁúãÂÆöÊó∂‰ªªÂä°ÁöÑÊâßË°åÊÉÖÂÜµ, Â¶Ç ÊòØÂê¶ÊàêÂäü, ÂΩìÂâçÁä∂ÊÄÅ, ÊâßË°å‰ªªÂä°Ëä±Ë¥πÁöÑÊó∂Èó¥Á≠â.</li>
<li>ÂèØÈÄâ Â§öËøõÁ®ã, Eventlet Âíå Gevent ‰∏âÁßçÊ®°ÂûãÂπ∂ÂèëÊâßË°å.</li>
<li>Celery ÊòØËØ≠Ë®ÄÊó†ÂÖ≥ÁöÑ.ÂÆÉÊèê‰æõ‰∫Üpython Á≠âÂ∏∏ËßÅËØ≠Ë®ÄÁöÑÊé•Âè£ÊîØÊåÅ.</li>
</ul>
<h2 id="CeleryÁªÑ‰ª∂"><a href="#CeleryÁªÑ‰ª∂" class="headerlink" title="CeleryÁªÑ‰ª∂"></a>CeleryÁªÑ‰ª∂</h2><h3 id="2-1-Celery-ÊâÆÊºîÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑËßíËâ≤"><a href="#2-1-Celery-ÊâÆÊºîÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑËßíËâ≤" class="headerlink" title="2.1 Celery ÊâÆÊºîÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑËßíËâ≤"></a>2.1 Celery ÊâÆÊºîÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÁöÑËßíËâ≤</h3><ul>
<li><p><strong>Celery Beat :</strong> ‰ªªÂä°Ë∞ÉÂ∫¶Âô®. Beat ËøõÁ®ã‰ºöËØªÂèñÈÖçÁΩÆÊñá‰ª∂ÁöÑÂÜÖÂÆπ, Âë®ÊúüÊÄßÁöÑÂ∞ÜÈÖçÁΩÆ‰∏≠Âà∞ÊúüÈúÄË¶ÅÊâßË°åÁöÑ‰ªªÂä°ÂèëÈÄÅÁªô‰ªªÂä°ÈòüÂàó.</p>
</li>
<li><p><strong>Celery Worker :</strong> ÊâßË°å‰ªªÂä°ÁöÑÊ∂àË¥πËÄÖ, ÈÄöÂ∏∏‰ºöÂú®Â§öÂè∞ÊúçÂä°Âô®ËøêË°åÂ§ö‰∏™Ê∂àË¥πËÄÖ, ÊèêÈ´òËøêË°åÊïàÁéá.</p>
</li>
<li><p><strong>Broker :</strong> Ê∂àÊÅØ‰ª£ÁêÜ, ÈòüÂàóÊú¨Ë∫´. ‰πüÁß∞‰∏∫Ê∂àÊÅØ‰∏≠Èó¥‰ª∂. Êé•Âèó‰ªªÂä°Áîü‰∫ßËÄÖÂèëÈÄÅËøáÊù•ÁöÑ‰ªªÂä°Ê∂àÊÅØ, Â≠òËøõÈòüÂàóÂÜçÊåâÂ∫èÂàÜÂèëÁªô‰ªªÂä°Ê∂àË¥πÊñπ(ÈÄöÂ∏∏ÊòØÊ∂àÊÅØÈòüÂàóÊàñËÄÖÊï∞ÊçÆÂ∫ì).</p>
</li>
<li><p><strong>Producer :</strong> ‰ªªÂä°Áîü‰∫ßËÄÖ. Ë∞ÉÁî® Celery API , ÂáΩÊï∞ÊàñËÄÖË£ÖÈ•∞Âô®, ËÄå‰∫ßÁîü‰ªªÂä°Âπ∂‰∫§Áªô‰ªªÂä°ÈòüÂàóÂ§ÑÁêÜÁöÑÈÉΩÊòØ‰ªªÂä°Áîü‰∫ßËÄÖ.</p>
</li>
<li><p><strong>Result Backend :</strong> ‰ªªÂä°Â§ÑÁêÜÂÆåÊàê‰πãÂêé‰øùÂ≠òÁä∂ÊÄÅ‰ø°ÊÅØÂíåÁªìÊûú, ‰ª•‰æõÊü•ËØ¢.</p>
</li>
</ul>
<h3 id="2-2-celeryÊû∂ÊûÑÂõæ"><a href="#2-2-celeryÊû∂ÊûÑÂõæ" class="headerlink" title="2.2 celeryÊû∂ÊûÑÂõæ"></a>2.2 celeryÊû∂ÊûÑÂõæ</h3><p><img src="/2018/02/13/celery/602127040446.png" loading="lazy"> </p>
<h3 id="2-3-‰∫ßÁîü‰ªªÂä°ÁöÑÊñπÂºè"><a href="#2-3-‰∫ßÁîü‰ªªÂä°ÁöÑÊñπÂºè" class="headerlink" title="2.3 ‰∫ßÁîü‰ªªÂä°ÁöÑÊñπÂºè"></a>2.3 ‰∫ßÁîü‰ªªÂä°ÁöÑÊñπÂºè</h3><ul>
<li><p>ÂèëÂ∏ÉËÄÖÂèëÂ∏É‰ªªÂä°(WEB Â∫îÁî®)</p>
</li>
<li><p>‰ªªÂä°Ë∞ÉÂ∫¶ÊåâÊúüÂèëÂ∏É‰ªªÂä°(ÂÆöÊó∂‰ªªÂä°)</p>
</li>
</ul>
<h3 id="2-4-celery-‰æùËµñ‰∏â‰∏™Â∫ì-Ëøô‰∏â‰∏™Â∫ì-ÈÉΩÁî±-Celery-ÁöÑÂºÄÂèëËÄÖÂºÄÂèëÂíåÁª¥Êä§"><a href="#2-4-celery-‰æùËµñ‰∏â‰∏™Â∫ì-Ëøô‰∏â‰∏™Â∫ì-ÈÉΩÁî±-Celery-ÁöÑÂºÄÂèëËÄÖÂºÄÂèëÂíåÁª¥Êä§" class="headerlink" title="2.4 celery ‰æùËµñ‰∏â‰∏™Â∫ì: Ëøô‰∏â‰∏™Â∫ì, ÈÉΩÁî± Celery ÁöÑÂºÄÂèëËÄÖÂºÄÂèëÂíåÁª¥Êä§."></a>2.4 celery ‰æùËµñ‰∏â‰∏™Â∫ì: Ëøô‰∏â‰∏™Â∫ì, ÈÉΩÁî± Celery ÁöÑÂºÄÂèëËÄÖÂºÄÂèëÂíåÁª¥Êä§.</h3><ul>
<li><code>billiard :</code> Âü∫‰∫é Python2.7 ÁöÑ multisuprocessing ËÄåÊîπËøõÁöÑÂ∫ì, ‰∏ªË¶ÅÁî®Êù•ÊèêÈ´òÊÄßËÉΩÂíåÁ®≥ÂÆöÊÄß.</li>
<li><code>librabbitmp : </code>C ËØ≠Ë®ÄÂÆûÁé∞ÁöÑ Python ÂÆ¢Êà∑Á´Ø</li>
<li><code>kombu :</code> Celery Ëá™Â∏¶ÁöÑÁî®Êù•Êî∂ÂèëÊ∂àÊÅØÁöÑÂ∫ì, Êèê‰æõ‰∫ÜÁ¨¶Âêà Python ËØ≠Ë®Ä‰π†ÊÉØÁöÑ, ‰ΩøÁî® AMQP ÂçèËÆÆÁöÑÈ´òÁ∫ßÂÄüÂè£.</li>
</ul>
<h2 id="ÈÖçÁΩÆCelery"><a href="#ÈÖçÁΩÆCelery" class="headerlink" title="ÈÖçÁΩÆCelery"></a>ÈÖçÁΩÆCelery</h2><h3 id="ÂÆâË£Öcelery"><a href="#ÂÆâË£Öcelery" class="headerlink" title="ÂÆâË£Öcelery"></a>ÂÆâË£Öcelery</h3><pre class=" language-python"><code class="language-python">pip install celery @ https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>celery<span class="token operator">/</span>celery<span class="token operator">/</span>tarball<span class="token operator">/</span>master</code></pre>
<h3 id="Êñ∞Âª∫celery-main-pyÈÖçÁΩÆcelery"><a href="#Êñ∞Âª∫celery-main-pyÈÖçÁΩÆcelery" class="headerlink" title="Êñ∞Âª∫celery/main.pyÈÖçÁΩÆcelery"></a>Êñ∞Âª∫<code>celery/main.py</code>ÈÖçÁΩÆcelery</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># celery_task/main.py</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> celery <span class="token keyword">import</span> Celery

<span class="token comment" spellcheck="true"># ÂÆö‰πâceleryÂÆû‰æã, ÈúÄË¶ÅÁöÑÂèÇÊï∞, 1, ÂÆû‰æãÂêç, 2, ‰ªªÂä°ÂèëÂ∏É‰ΩçÁΩÆ, 3, ÁªìÊûú‰øùÂ≠ò‰ΩçÁΩÆ</span>
app <span class="token operator">=</span> Celery<span class="token punctuation">(</span><span class="token string">'mycelery'</span><span class="token punctuation">,</span>
             broker<span class="token operator">=</span><span class="token string">'redis://127.0.0.1:6379/14'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># ‰ªªÂä°Â≠òÊîæÁöÑÂú∞Êñπ </span>
             backend<span class="token operator">=</span><span class="token string">'redis://127.0.0.1:6379/15'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ÁªìÊûúÂ≠òÊîæÁöÑÂú∞Êñπ</span>


@app<span class="token punctuation">.</span>task
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y</code></pre>
<h2 id="ÊµãËØï"><a href="#ÊµãËØï" class="headerlink" title="ÊµãËØï"></a>ÊµãËØï</h2><h3 id="ÂêØÂä®celery"><a href="#ÂêØÂä®celery" class="headerlink" title="ÂêØÂä®celery"></a>ÂêØÂä®celery</h3><pre class=" language-python"><code class="language-python"><span class="token triple-quoted-string string">'''1.ÂêØÂä®celery'''</span>
<span class="token comment" spellcheck="true">#1.1 ÂçïËøõÁ®ãÂêØÂä®celery</span>
celery <span class="token operator">-</span>A main worker <span class="token operator">-</span>l INFO
<span class="token comment" spellcheck="true">#1.2 celeryÁÆ°ÁêÜ</span>
celery multi start celery_test <span class="token operator">-</span>A celery_test <span class="token operator">-</span>l debug <span class="token operator">-</span><span class="token operator">-</span>autoscale<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">5</span>        <span class="token comment" spellcheck="true"># celeryÂπ∂ÂèëÊï∞ÔºöÊúÄÂ§ö50‰∏™ÔºåÊúÄÂ∞ë5‰∏™</span>
ps auxww<span class="token operator">|</span>grep <span class="token string">"celery worker"</span><span class="token operator">|</span>grep <span class="token operator">-</span>v grep<span class="token operator">|</span>awk <span class="token string">'{print $2{'</span><span class="token operator">|</span>xargs kill <span class="token operator">-</span><span class="token number">9</span>       <span class="token comment" spellcheck="true"># ÂÖ≥Èó≠ÊâÄÊúâceleryËøõÁ®ã</span></code></pre>
<h2 id="1-‰ΩøÁî®celeryÂºÇÊ≠•ÂèëÈÄÅÁü≠‰ø°"><a href="#1-‰ΩøÁî®celeryÂºÇÊ≠•ÂèëÈÄÅÁü≠‰ø°" class="headerlink" title="1.‰ΩøÁî®celeryÂºÇÊ≠•ÂèëÈÄÅÁü≠‰ø°"></a>1.‰ΩøÁî®celeryÂºÇÊ≠•ÂèëÈÄÅÁü≠‰ø°</h2><h3 id="1-1-Âú®celery-task-mian-py‰∏≠Ê∑ªÂä†ÂèëÈÄÅÁü≠‰ø°ÂáΩÊï∞"><a href="#1-1-Âú®celery-task-mian-py‰∏≠Ê∑ªÂä†ÂèëÈÄÅÁü≠‰ø°ÂáΩÊï∞" class="headerlink" title="1.1 Âú®celery_task/mian.py‰∏≠Ê∑ªÂä†ÂèëÈÄÅÁü≠‰ø°ÂáΩÊï∞"></a>1.1 Âú®<code>celery_task/mian.py</code>‰∏≠Ê∑ªÂä†ÂèëÈÄÅÁü≠‰ø°ÂáΩÊï∞</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># celeryÈ°πÁõÆ‰∏≠ÁöÑÊâÄÊúâÂØºÂåÖÂú∞ÂùÄ, ÈÉΩÊòØ‰ª•CELERY_BASE_DIR‰∏∫Âü∫ÂáÜËÆæÂÆö.</span>
<span class="token comment" spellcheck="true"># ÊâßË°åceleryÂëΩ‰ª§Êó∂, ‰πüÈúÄË¶ÅËøõÂÖ•CELERY_BASE_DIRÁõÆÂΩïÊâßË°å.</span>
CELERY_BASE_DIR <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span>


@app<span class="token punctuation">.</span>task<span class="token punctuation">(</span>bind<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">send_sms_code</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> datas<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>CELERY_BASE_DIR<span class="token punctuation">,</span> <span class="token string">'../syl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># Âú®ÊñπÊ≥ï‰∏≠ÂØºÂåÖ</span>
    <span class="token keyword">from</span> libs<span class="token punctuation">.</span>rl_sms <span class="token keyword">import</span> send_message
    <span class="token comment" spellcheck="true"># time.sleep(5)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Áî® res Êé•Êî∂ÂèëÈÄÅÁªìÊûú, ÊàêÂäüÊòØ:ÔºêÔºå„ÄÄÂ§±Ë¥•ÊòØÔºöÔºçÔºë</span>
        res <span class="token operator">=</span> send_message<span class="token punctuation">(</span>mobile<span class="token punctuation">,</span> datas<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token string">'-1'</span>

    <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">'-1'</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Â¶ÇÊûúÂèëÈÄÅÁªìÊûúÊòØ -1  Â∞±ÈáçËØï.</span>
        self<span class="token punctuation">.</span>retry<span class="token punctuation">(</span>countdown<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> exc<span class="token operator">=</span>Exception<span class="token punctuation">(</span><span class="token string">'Áü≠‰ø°ÂèëÈÄÅÂ§±Ë¥•'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="1-2-Âú®verifications-views-py‰∏≠Ê∑ªÂä†celeryÂèëÈÄÅÁü≠‰ø°ËßÜÂõæÂáΩÊï∞"><a href="#1-2-Âú®verifications-views-py‰∏≠Ê∑ªÂä†celeryÂèëÈÄÅÁü≠‰ø°ËßÜÂõæÂáΩÊï∞" class="headerlink" title="1.2 Âú®verifications/views.py‰∏≠Ê∑ªÂä†celeryÂèëÈÄÅÁü≠‰ø°ËßÜÂõæÂáΩÊï∞"></a>1.2 Âú®<code>verifications/views.py</code>‰∏≠Ê∑ªÂä†celeryÂèëÈÄÅÁü≠‰ø°ËßÜÂõæÂáΩÊï∞</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SmsCodeView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""‰ΩøÁî®apiviewÁöÑÈôêÊµÅ"""</span>
    <span class="token comment" spellcheck="true"># 1. ÊâÄÊúâ‰∫∫ÂèØ‰ª•ËÆøÈóÆ</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># 1. Ëé∑ÂèñÂèÇÊï∞</span>
        phone <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'phone'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ÊâãÊú∫Âè∑</span>
        image_code <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'image_code'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ÂõæÁâáÈ™åËØÅÁ†Å</span>
        image_code_uuid <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'image_code_uuid'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ÂâçÁ´ØÁîüÊàêÁöÑuuid</span>

        <span class="token comment" spellcheck="true"># 2. Ê£ÄÊü•ÂèÇÊï∞</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> all<span class="token punctuation">(</span><span class="token punctuation">[</span>phone<span class="token punctuation">,</span> image_code<span class="token punctuation">,</span> image_code_uuid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"ÂèÇÊï∞‰∏çÂÖ®"</span><span class="token punctuation">{</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>r<span class="token string">'^1[3456789]\d{9{$'</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"ÊâãÊú∫Âè∑Á†Å‰∏çÊ≠£Á°Æ"</span><span class="token punctuation">{</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 3. Ê£ÄÊü•ÊòØÂê¶ÂèëÈÄÅ</span>
        redis_client <span class="token operator">=</span> get_redis_connection<span class="token punctuation">(</span><span class="token string">'img_code'</span><span class="token punctuation">)</span>
        phone_exists <span class="token operator">=</span> redis_client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>phone<span class="token punctuation">)</span>
        <span class="token keyword">if</span> phone_exists<span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"È¢ëÁπÅÂèëÈÄÅ, ËØ∑Á®çÂêéÂÜçËØï"</span><span class="token punctuation">{</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># È™åËØÅÂõæÂΩ¢È™åËØÅÁ†Å</span>
        redis_image_code <span class="token operator">=</span> redis_client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>image_code_uuid<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># bytes</span>
        <span class="token keyword">if</span> redis_image_code<span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true"># bytes ËΩ¨Êàê string</span>
            redis_image_code <span class="token operator">=</span> redis_image_code<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># ÊØîËæÉÁî®Êà∑Êèê‰æõÁöÑÂõæÁâáÂÜÖÂÆπÊòØÂê¶Âíåredis‰∏≠‰øùÂ≠òÁöÑ‰∏ÄËá¥</span>
        <span class="token keyword">if</span> image_code<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> redis_image_code<span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'ÂõæÁâáÈ™åËØÅÁ†Å‰∏çÊ≠£Á°Æ'</span><span class="token punctuation">{</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 4. ÂèëÈÄÅ</span>
        code <span class="token operator">=</span> <span class="token string">'%06d'</span> <span class="token operator">%</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ÈöèÊú∫6‰ΩçÈ™åËØÅÁ†Å</span>

        <span class="token keyword">from</span> syl<span class="token punctuation">.</span>settings <span class="token keyword">import</span> BASE_DIR
        sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>BASE_DIR<span class="token punctuation">,</span> <span class="token string">'../celery_task'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">from</span> main <span class="token keyword">import</span> send_sms_code  <span class="token comment" spellcheck="true"># ÂøÖÈ°ªËøô‰πàÂÜô, ‰ªémain‰∏≠ÂØºÂåÖ</span>

        send_sms_code<span class="token punctuation">.</span>delay<span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 5.‰ΩøÁî® pipeline ÊâπÈáèÊìç‰Ωú</span>
        pl <span class="token operator">=</span> redis_client<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># ÂÆû‰æãÂåñpipelineÂØπË±°</span>
        pl<span class="token punctuation">.</span>setex<span class="token punctuation">(</span>phone<span class="token punctuation">,</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># Â≠òÂÇ®phone:code, 5ÂàÜÈíüÊúâÊïàÊúü</span>
        pl<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>image_code_uuid<span class="token punctuation">)</span>      <span class="token comment" spellcheck="true"># ‰ªéredis‰∏≠Âà†Èô§Ëøô‰∏™ÂõæÁâáÈ™åËØÅÁ†Å, ‰ª•Èò≤ÂÜçÊ¨°Ë¢´‰ΩøÁî®</span>
        pl<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># 6. ËøîÂõûÁªìÊûú</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"Áü≠‰ø°ÂèëÈÄÅÊàêÂäü"</span><span class="token punctuation">{</span><span class="token punctuation">)</span></code></pre>
<h3 id="1-3-Ê∑ªÂä†Ë∑ØÁî±"><a href="#1-3-Ê∑ªÂä†Ë∑ØÁî±" class="headerlink" title="1.3 Ê∑ªÂä†Ë∑ØÁî±"></a>1.3 Ê∑ªÂä†Ë∑ØÁî±</h3><pre class=" language-python"><code class="language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'sms_codes/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>SmsCodeView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre>
<h2 id="2-ÊµãËØïÊé•Âè£"><a href="#2-ÊµãËØïÊé•Âè£" class="headerlink" title="2.ÊµãËØïÊé•Âè£"></a>2.ÊµãËØïÊé•Âè£</h2><ul>
<li>Êé•Âè£URL</li>
</ul>
<pre><code>http://192.168.56.100:8888/user/sms_codes/</code></pre>
<ul>
<li>ËØ∑Ê±ÇÊê∫Â∏¶ÂèÇÊï∞</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token punctuation">{</span>
    <span class="token string">"phone"</span><span class="token punctuation">:</span> <span class="token number">18538752511</span><span class="token punctuation">,</span>
    <span class="token string">"image_code"</span><span class="token punctuation">:</span><span class="token string">"aed3"</span><span class="token punctuation">,</span>                                         <span class="token comment" spellcheck="true"># ÂâçÁ´ØÁîüÊàêÁöÑ ÂõæÂΩ¢È™åËØÅÁ†Å</span>
    <span class="token string">"image_code_uuid"</span><span class="token punctuation">:</span><span class="token string">"de8edce2-fc9f-11ea-9325-005056c00008"</span>     <span class="token comment" spellcheck="true"># ÂâçÁ´ØÁîüÊàêÁöÑuuid</span>
<span class="token punctuation">{</span></code></pre>
<h2 id="djangoÊ∑ªÂä†Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÊâãÊú∫Âè∑Êï∞ÈáèÊé•Âè£"><a href="#djangoÊ∑ªÂä†Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÊâãÊú∫Âè∑Êï∞ÈáèÊé•Âè£" class="headerlink" title="djangoÊ∑ªÂä†Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÊâãÊú∫Âè∑Êï∞ÈáèÊé•Âè£"></a>djangoÊ∑ªÂä†Ê£ÄÊü•Áî®Êà∑ÂêçÂíåÊâãÊú∫Âè∑Êï∞ÈáèÊé•Âè£</h2><h3 id="1-1-Âú®user-urls-py‰∏≠Ê∑ªÂä†"><a href="#1-1-Âú®user-urls-py‰∏≠Ê∑ªÂä†" class="headerlink" title="1.1 Âú®user/urls.py‰∏≠Ê∑ªÂä†"></a>1.1 Âú®<code>user/urls.py</code>‰∏≠Ê∑ªÂä†</h3><pre class=" language-python"><code class="language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'count/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>RegCountView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># Êü•ËØ¢Áî®Êà∑ÂêçÊâãÊú∫Âè∑‰ΩøÁî®ÈáèÁöÑËßÜÂõæ,  /user/count/</span>
<span class="token punctuation">]</span></code></pre>
<h3 id="1-2-Âú®user-views-py‰∏≠Ê∑ªÂä†ËßÜÂõæÂáΩÊï∞"><a href="#1-2-Âú®user-views-py‰∏≠Ê∑ªÂä†ËßÜÂõæÂáΩÊï∞" class="headerlink" title="1.2 Âú®user/views.py‰∏≠Ê∑ªÂä†ËßÜÂõæÂáΩÊï∞"></a>1.2 Âú®<code>user/views.py</code>‰∏≠Ê∑ªÂä†ËßÜÂõæÂáΩÊï∞</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Êü•ËØ¢Áî®Êà∑Êï∞ÈáèÊé•Âè£</span>
<span class="token keyword">class</span> <span class="token class-name">RegCountView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># Ê≥®ÂÜåÊó∂ÈúÄË¶ÅÈ™åËØÅÁöÑÁî®Êà∑ÂêçÂíåÊâãÊú∫Âè∑ÊòØÂê¶‰ΩøÁî®</span>

    <span class="token comment" spellcheck="true"># Ëá™ÂÆö‰πâÊùÉÈôêÁ±ª</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true"># Êé•Êî∂ÂèÇÊï∞:  È™åËØÅÁöÑÂÜÖÂÆπtype: username/phone,  data: 'Áî®Êà∑Âêç' ÊàñËÄÖ 'ÊâãÊú∫Âè∑',</span>
        datatype <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> all<span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">,</span> datatype<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'ÂèÇÊï∞‰∏çÂÆåÊï¥'</span><span class="token punctuation">{</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> datatype <span class="token operator">==</span> <span class="token string">'username'</span><span class="token punctuation">:</span>
            count <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>username<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> datatype <span class="token operator">==</span> <span class="token string">'phone'</span><span class="token punctuation">:</span>
            count <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>phone<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'Êü•ËØ¢ÊàêÂäü'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span> datatype<span class="token punctuation">,</span> <span class="token string">'count'</span><span class="token punctuation">:</span> count<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">)</span></code></pre>
<h2 id="ÊµãËØïÊé•Âè£"><a href="#ÊµãËØïÊé•Âè£" class="headerlink" title="ÊµãËØïÊé•Âè£"></a>ÊµãËØïÊé•Âè£</h2><ul>
<li>ÊµãËØïÊé•Âè£URL</li>
</ul>
<pre class=" language-javascript"><code class="language-javascript">http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">56.100</span><span class="token punctuation">:</span><span class="token number">8888</span><span class="token operator">/</span>user<span class="token regex">/count/</span></code></pre>
<h2 id="ÂÆåÂñÑÊ≥®ÂÜåÊé•Âè£"><a href="#ÂÆåÂñÑÊ≥®ÂÜåÊé•Âè£" class="headerlink" title="ÂÆåÂñÑÊ≥®ÂÜåÊé•Âè£"></a>ÂÆåÂñÑÊ≥®ÂÜåÊé•Âè£</h2><h3 id="‰øÆÊîπuser-views-py‰∏≠ÂÆåÂñÑËßÜÂõæÂáΩÊï∞"><a href="#‰øÆÊîπuser-views-py‰∏≠ÂÆåÂñÑËßÜÂõæÂáΩÊï∞" class="headerlink" title="‰øÆÊîπuser/views.py‰∏≠ÂÆåÂñÑËßÜÂõæÂáΩÊï∞"></a>‰øÆÊîπ<code>user/views.py</code>‰∏≠ÂÆåÂñÑËßÜÂõæÂáΩÊï∞</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Ê≥®ÂÜåÊé•Âè£</span>
<span class="token keyword">class</span> <span class="token class-name">RegisterView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Áî®Êà∑Ê≥®ÂÜå, ÊùÉÈôêÊòØ: ÂåøÂêçÁî®Êà∑ÂèØËÆøÈóÆ
    """</span>
    <span class="token comment" spellcheck="true"># Ëá™ÂÆö‰πâÊùÉÈôêÁ±ª</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">(</span>AllowAny<span class="token punctuation">,</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Êé•Êî∂Áî®Êà∑Âêç,ÂØÜÁ†Å,ÊâãÊú∫Âè∑ÂíåÈ™åËØÅÁ†Å, ÂâçÁ´ØÊ†°È™å‰∏§ÈÅç‰∏ÄËá¥ÊÄß, Ê≥®ÂÜåÊàêÂäüÂêéËøîÂõûÊàêÂäü, ÁÑ∂ÂêéÁî®Êà∑Ëá™Ë°åÁôªÂΩïËé∑Âèñtoken
        1. Áî®Êà∑Âêç
        2. ÂØÜÁ†Å
        3. ÊâãÊú∫Âè∑
        4. È™åËØÅÁ†Å
        :param request:
        :return:  {'code':0,'msg':'Ê≥®ÂÜåÊàêÂäü'{
        code: "260361"
        password: "123123"
        phone: "13303479527"
        username: "liangxuepeng"
        """</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
        phone <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'phone'</span><span class="token punctuation">)</span>
        code <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span>
        passwrod <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> all<span class="token punctuation">(</span><span class="token punctuation">[</span>username<span class="token punctuation">,</span> passwrod<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> code<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'ÂèÇÊï∞‰∏çÂÖ®'</span><span class="token punctuation">{</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true"># rand_name = self.randomUsername()</span>
        <span class="token comment" spellcheck="true"># È™åËØÅÊâãÊú∫È™åËØÅÁ†Å</span>
        redis_client <span class="token operator">=</span> get_redis_connection<span class="token punctuation">(</span><span class="token string">'verify_code'</span><span class="token punctuation">)</span>
        code_redis <span class="token operator">=</span> redis_client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>phone<span class="token punctuation">)</span>
        <span class="token keyword">if</span> code_redis<span class="token punctuation">:</span>
            code_redis <span class="token operator">=</span> code_redis<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token operator">not</span> code <span class="token operator">==</span> code_redis<span class="token punctuation">:</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token number">999</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'ÊâãÊú∫È™åËØÅÁ†ÅÈîôËØØ'</span><span class="token punctuation">{</span><span class="token punctuation">)</span>

        user <span class="token operator">=</span> User<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> phone<span class="token operator">=</span>phone<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>passwrod<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'code'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'Ê≥®ÂÜåÊàêÂäü'</span><span class="token punctuation">{</span><span class="token punctuation">)</span></code></pre>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Â§©Âê¨</li><li class="post-copyright-link"><strong>Post link: </strong><a href="http://godhearing.cn/2018/02/13/celery/" title="Celery">http://godhearing.cn/2018/02/13/celery/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2018/04/02/liao-tian-shi/" rel="prev" title="ËÅäÂ§©ÂÆ§"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">ËÅäÂ§©ÂÆ§</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2018/02/02/python-de-la-ji-hui-shou-ji-zhi/" rel="next" title="PythonÁöÑÂûÉÂúæÂõûÊî∂Êú∫Âà∂"><span class="post-nav-text">PythonÁöÑÂûÉÂúæÂõûÊî∂Êú∫Âà∂</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>ÁÇπÂáªÊåâÈíÆË∑≥ËΩ¨ GitHub Issues ËØÑËÆ∫„ÄÇ</span><br><span>Ëã•Ê≤°ÊúâÊú¨Êñá IssueÔºåÊÇ®ÂèØ‰ª•‰ΩøÁî® Comment Ê®°ÁâàÊñ∞Âª∫„ÄÇ</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/YunYouJun/yunyoujun.github.io/issues?q=is:issue+Celery">GitHub Issues</a><a class="hty-button hty-button--raised" id="github-discussions" target="_blank" rel="noopener" href="https://github.com/YunYouJun/yunyoujun.github.io/discussions/new">GitHub Discussions</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">ÂÜÄICPÂ§á2021002475Âè∑-1</a></div><div class="copyright"><span>&copy; 2017 ‚Äì 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Â§© Âê¨</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.3.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.4.0</span></div><div class="live_time"><span>Êú¨ÂçöÂÆ¢Â∑≤ËêåËêåÂìíÂú∞ËøêË°å</span><span id="display_live_time"></span><span class="moe-text">(‚óè'‚ó°'‚óè)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2017-07-12T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " Â§© " + passHour + " Â∞èÊó∂ " + passMinute + " ÂàÜ " + passSecond + " Áßí";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#4e72b8" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="ÂºÄÂßãÈù¢ÂêëÊêúÁ¥¢ÂºïÊìéÁºñÁ®ã" value=""></div><div id="local-search-result"></div></div><script>const date = new Date();
const today = (date.getMonth() + 1) + "-" + date.getDate()
const mourn_days = ["4-4","9-18"]
if (mourn_days.includes(today)) {
  document.documentElement.style.filter = "grayscale(1)";
}</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":250,"height":500},"mobile":{"show":true},"rect":"opacity:0.7","log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>